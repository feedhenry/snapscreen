String.prototype.format = String.prototype.f = function() {

    var s = this,
        i = arguments.length;

    while (i--) {
        s = s.replace(new RegExp('\\{' + i + '\\}', 'gm'), arguments[i]);
    }
    return s;
}

module.exports.makeRequest = function(parameters, auth, cb) {
    var parametersString = '';
    for (var key in parameters) {
      if(key !== 'uri') {
        if (parametersString !== '') parametersString += '&';
        parametersString += key + '=' + parameters[key];  
      }
    }

    var baseUri = 'http://data.tmsapi.com/v1.1/' + parameters.uri;

    var authorizationParameters = 'api_key=' + auth.apiKey;

    var requestUri = '{0}?{1}&{2}'.format(baseUri, parametersString, authorizationParameters);
    var http = require('http');
    var response = '';
    http.get(requestUri, function(apiRes) {
        if (apiRes.statusCode == 403) {
            cb({ error: true, errorMessage: 'unauthorised' });
            return;
        }

        apiRes.on('data', function(data) {
            response += data;
        });

        apiRes.on('end', function() {
            cb(JSON.parse(response));
        });
    });

    return 'done';
}
